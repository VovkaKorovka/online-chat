<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Онлайн чат</title>
    <style>
        body { font-family: sans-serif; margin:0; padding:0; display:flex; flex-direction:column; height:100vh; }
        #chat { flex:1; overflow-y:auto; padding:10px; border-bottom:1px solid #ccc; }
        #status { font-size: 0.9em; color:#555; padding:5px; }
        #input { display:flex; }
        #input input { flex:1; padding:10px; font-size:1em; }
        #input button { padding:10px; }
        .message { margin-bottom:5px; }
        .system { color: gray; font-style: italic; }
        .typing { font-size:0.8em; color: #888; }
    </style>
</head>
<body>
    <div id="chat"></div>
    <div id="status">Онлайн: 0</div>
    <div id="input">
        <input type="text" id="msg" placeholder="Напиши повідомлення...">
        <button id="send">Відправити</button>
    </div>

    <script>
        const chat = document.getElementById("chat");
        const status = document.getElementById("status");
        const msgInput = document.getElementById("msg");
        const sendBtn = document.getElementById("send");

        const ws = new WebSocket(`wss://${window.location.host}`);
        let userName = "";

        ws.onopen = () => console.log("Підключено до сервера");

        ws.onmessage = (event) => {
            const msg = JSON.parse(event.data);

            if(msg.type === "init") {
                userName = msg.user;
                status.textContent = `Онлайн: ${msg.online}`;
            }

            if(msg.type === "system") {
                const div = document.createElement("div");
                div.className = "message system";
                div.textContent = msg.text;
                chat.appendChild(div);
                status.textContent = `Онлайн: ${msg.online}`;
                chat.scrollTop = chat.scrollHeight;
            }

            if(msg.type === "chat") {
                const div = document.createElement("div");
                div.className = "message";
                div.textContent = `${msg.user}: ${msg.text}`;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            }

            if(msg.type === "typing") {
                status.textContent = `${msg.user} пише...`;
                setTimeout(() => {
                    status.textContent = `Онлайн: ${wss ? wss.clients.size : "?"}`;
                }, 1000);
            }
        };

        function sendMessage() {
            const text = msgInput.value.trim();
            if(text === "") return;
            ws.send(JSON.stringify({ type: "chat", text }));
            msgInput.value = "";
        }

        sendBtn.onclick = sendMessage;
        msgInput.addEventListener("keydown", (e) => {
            if(e.key === "Enter") sendMessage();
            else ws.send(JSON.stringify({ type:"typing" }));
        });
    </script>
</body>
</html>
